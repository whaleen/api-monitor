console.log("Background script loaded!");const t=new WebSocket("ws://localhost:8080");t.onopen=()=>console.log("WebSocket connected");t.onerror=e=>console.error("WebSocket error:",e);const r=new Map;chrome.webRequest.onBeforeRequest.addListener(e=>{if(e.method==="POST"&&e.requestBody&&e.requestBody.raw)try{const o=e.requestBody.raw[0].bytes,c=new TextDecoder("utf-8").decode(o),s=JSON.parse(c);r.set(e.requestId,{method:s.name,url:e.url,payload:s})}catch{}},{urls:["<all_urls>"]},["requestBody"]);chrome.webRequest.onCompleted.addListener(async e=>{const o=r.get(e.requestId);o&&(console.log("API Call:",{method:o.method,url:o.url,requestPayload:o.payload}),t.readyState===WebSocket.OPEN&&(t.send(JSON.stringify({method:o.method,url:o.url,payload:o.payload,timestamp:Date.now()})),console.log("We sent API call to WebSocket")),r.delete(e.requestId))},{urls:["<all_urls>"]});
